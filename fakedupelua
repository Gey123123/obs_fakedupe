local Players = game:GetService("Players")
local player = Players.LocalPlayer

local visualDuplicates = {}

local function waitForPlayerGui()
	local t = os.clock()
	while not player:FindFirstChild("PlayerGui") do
		if os.clock() - t > 5 then return false end
		task.wait()
	end
	return true
end

local function findRealInventory()
	local gui = player:FindFirstChild("PlayerGui")
	for _, child in ipairs(gui:GetDescendants()) do
		if child:IsA("Frame") and (child.Name:lower():match("container") or child.Name:lower():match("pet")) then
			return child
		end
	end
	return nil
end

local function getHeldPet()
	local char = player.Character
	if not char then return nil end
	for _, child in ipairs(char:GetChildren()) do
		if child:IsA("Model") and (child.Name:match("Pet") or child.Name:match("Bee") or child.Name:match("Raccoon") or child.Name:match("Butterfly")) then
			return child
		end
	end
	return nil
end

local function duplicateHeldPet()
	local pet = getHeldPet()
	if not pet then return end

	-- Duplicate Inventory Button
	local inventory = findRealInventory()
	if inventory then
		local foundBtn = nil
		for _, d in ipairs(inventory:GetDescendants()) do
			if (d:IsA("TextButton") or d:IsA("ImageButton")) and d.Name:match(pet.Name) then
				foundBtn = d
				break
			end
		end

		if foundBtn then
			local clone = foundBtn:Clone()
			clone.Name = foundBtn.Name .. "_COPY"
			clone.Text = pet.Name -- âœ… Overwrite old text
			clone.Parent = foundBtn.Parent
			table.insert(visualDuplicates, clone)
		else
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(0, 100, 0, 100)
			btn.Name = pet.Name .. "_COPY"
			btn.Text = pet.Name -- âœ… Name only
			btn.Parent = inventory
			table.insert(visualDuplicates, btn)
		end
	end

	-- Duplicate pet model (visual only)
	local charPet = pet:Clone()
	for _, child in ipairs(charPet:GetDescendants()) do
		if child:IsA("Script") or child:IsA("LocalScript") then
			child:Destroy()
		end
	end
	for _, val in ipairs({"KG_Value", "Level"}) do
		if pet:FindFirstChild(val) then
			local v = Instance.new("NumberValue")
			v.Name = val
			v.Value = pet[val].Value
			v.Parent = charPet
		end
	end
	charPet.Parent = player.Character
	if player.Character:FindFirstChild("HumanoidRootPart") then
		charPet:PivotTo(player.Character.HumanoidRootPart.CFrame * CFrame.new(1, 0, -1.5))
	end
	table.insert(visualDuplicates, charPet)
end

local function createUI()
	if player.PlayerGui:FindFirstChild("PetDuplicatorUI") then
		player.PlayerGui.PetDuplicatorUI:Destroy()
	end

	local gui = Instance.new("ScreenGui", player.PlayerGui)
	gui.Name = "PetDuplicatorUI"
	gui.ResetOnSpawn = false

	local frame = Instance.new("Frame", gui)
	frame.Size = UDim2.new(0, 200, 0, 100)
	frame.Position = UDim2.new(0.7, 0, 0.3, 0)
	frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	frame.BackgroundTransparency = 0.2
	frame.BorderSizePixel = 0
	frame.Draggable = true
	frame.Active = true
	Instance.new("UICorner", frame).CornerRadius = UDim.new(0, ðŸ˜Ž

	local title = Instance.new("TextLabel", frame)
	title.Size = UDim2.new(1, 0, 0.4, 0)
	title.Position = UDim2.new(0, 0, 0, 0)
	title.Text = "g3zmar hub v.1"
	title.Font = Enum.Font.GothamBold
	title.TextSize = 16
	title.TextColor3 = Color3.fromRGB(0, 255, 255)
	title.BackgroundTransparency = 1

	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(0.8, 0, 0.3, 0)
	btn.Position = UDim2.new(0.1, 0, 0.6, 0)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
	btn.Text = "Checking..."
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

	btn.MouseButton1Click:Connect(duplicateHeldPet)

	task.spawn(function()
		while btn.Parent do
			local pet = getHeldPet()
			if pet then
				btn.Text = "Duplicate " .. pet.Name -- âœ… Final clean name
				btn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
				btn.TextColor3 = Color3.fromRGB(255, 255, 255)
			else
				btn.Text = "Not Holding Any Pet"
				btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
				btn.TextColor3 = Color3.fromRGB(200, 200, 200)
			end
			task.wait(1)
		end
	end)

	player.CharacterAdded:Connect(function()
		task.wait(1)
		for _, d in ipairs(visualDuplicates) do
			pcall(function() d:Destroy() end)
		end
		visualDuplicates = {}
	end)
end

if waitForPlayerGui() then
	if not player.Character then player.CharacterAdded:Wait() end
	pcall(createUI)
end
